import json
import random

def handler(event: dict, context) -> dict:
    '''API –¥–ª—è —á–∞—Ç-–±–æ—Ç–∞ –ø–æ–º–æ—â–Ω–∏–∫–∞ —Å —É–º–Ω—ã–º —Ä–µ–∂–∏–º–æ–º –¥–ª—è –ø—Ä–µ–º–∏—É–º-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π'''
    method = event.get('httpMethod', 'GET')
    
    if method == 'OPTIONS':
        return {
            'statusCode': 200,
            'headers': {
                'Access-Control-Allow-Origin': '*',
                'Access-Control-Allow-Methods': 'POST, OPTIONS',
                'Access-Control-Allow-Headers': 'Content-Type'
            },
            'body': ''
        }
    
    if method != 'POST':
        return {
            'statusCode': 405,
            'headers': {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'},
            'body': json.dumps({'error': 'Method not allowed'})
        }
    
    try:
        body = json.loads(event.get('body', '{}'))
        message = body.get('message', '').lower()
        is_premium = body.get('isPremium', False)
        
        if not message:
            return {
                'statusCode': 400,
                'headers': {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'},
                'body': json.dumps({'error': 'Message is required'})
            }
        
        if is_premium:
            response_text = get_smart_response(message)
        else:
            basic_responses = [
                '–•–º, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–ø—Ä–æ—Å–∏—Ç—å –ø—Ä–æ—â–µ...',
                '–Ø –Ω–µ–º–Ω–æ–≥–æ –∑–∞–ø—É—Ç–∞–ª—Å—è, –º–æ–∂–µ—Ç–µ —É—Ç–æ—á–Ω–∏—Ç—å?',
                '–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –ù–æ —è –Ω–µ —É–≤–µ—Ä–µ–Ω...',
                '–ú–æ–∂–µ—Ç –±—ã—Ç—å, –¥–∞, –∞ –º–æ–∂–µ—Ç –∏ –Ω–µ—Ç ü§î',
                '–≠—Ç–æ —Å–ª–æ–∂–Ω–æ... –ê —á—Ç–æ –µ—Å–ª–∏ –ø–æ–∏—Å–∫–∞—Ç—å –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ?',
                '–≠—ç—ç... –∑–∞–±—ã–ª —á—Ç–æ —Ö–æ—Ç–µ–ª —Å–∫–∞–∑–∞—Ç—å üòÖ',
                '–ö–∞–∂–µ—Ç—Å—è, —è —á—Ç–æ-—Ç–æ –∑–Ω–∞—é –ø—Ä–æ —ç—Ç–æ... –∏–ª–∏ –Ω–µ—Ç?'
            ]
            response_text = random.choice(basic_responses)
        
        return {
            'statusCode': 200,
            'headers': {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'},
            'body': json.dumps({
                'response': response_text,
                'isPremium': is_premium
            })
        }
    
    except Exception as e:
        return {
            'statusCode': 500,
            'headers': {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'},
            'body': json.dumps({'error': f'Server error: {str(e)}'})
        }


def get_smart_response(message: str) -> str:
    '''–£–º–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤–æ–ø—Ä–æ—Å–∞ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –ø—Ä–µ–º–∏—É–º'''
    
    cities_info = {
        '–º–æ—Å–∫–≤–∞': {
            'tips': '–ú–æ—Å–∫–≤–∞ - —Å–∞–º–æ–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ. –ë—Ä–æ–Ω–∏—Ä—É–π—Ç–µ –∑–∞ 2-3 –Ω–µ–¥–µ–ª–∏ –¥–ª—è —Ü–µ–Ω –æ—Ç 5 000‚ÇΩ. –õ—É—á—à–µ–µ –≤—Ä–µ–º—è - –±—É–¥–Ω–∏.',
            'airlines': '–ê—ç—Ä–æ—Ñ–ª–æ—Ç, S7 –∏ Utair –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç –ø—Ä—è–º—ã–µ —Ä–µ–π—Å—ã. –ê—ç—Ä–æ—Ñ–ª–æ—Ç —á–∞—Å—Ç–æ –¥–µ—à–µ–≤–ª–µ —É—Ç—Ä–æ–º.',
            'best_time': '–û–ø—Ç–∏–º–∞–ª—å–Ω–æ –ª–µ—Ç–µ—Ç—å –≤—Ç–æ—Ä–Ω–∏–∫-—á–µ—Ç–≤–µ—Ä–≥, —ç–∫–æ–Ω–æ–º–∏—è –¥–æ 35%.'
        },
        '–ø–µ—Ç–µ—Ä–±—É—Ä–≥': {
            'tips': '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ - –±–∏–ª–µ—Ç—ã –æ—Ç 4 200‚ÇΩ. –†–∞–Ω–µ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–≥–æ–¥–Ω–µ–µ –Ω–∞ 40%.',
            'airlines': 'S7 –∏ –ê—ç—Ä–æ—Ñ–ª–æ—Ç - –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–∫—Ü–∏–∏ –Ω–∞ —Å–∞–π—Ç–∞—Ö.',
            'best_time': '–ò–∑–±–µ–≥–∞–π—Ç–µ –ø—è—Ç–Ω–∏—Ü—ã –∏ –≤—ã—Ö–æ–¥–Ω—ã—Ö - —Ü–µ–Ω—ã –≤—ã—à–µ –Ω–∞ 50%.'
        },
        '—Å–æ—á–∏': {
            'tips': '–°–æ—á–∏ - –∫—É—Ä–æ—Ä—Ç–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, —Ü–µ–Ω—ã –æ—Ç 8 300‚ÇΩ. –õ–µ—Ç–æ–º –¥–æ—Ä–æ–∂–µ –≤ 2 —Ä–∞–∑–∞.',
            'airlines': 'Utair –∏ –ê—ç—Ä–æ—Ñ–ª–æ—Ç –ª–µ—Ç–∞—é—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ. –ò—â–∏—Ç–µ –∞–∫—Ü–∏–∏ –∑–∞ –º–µ—Å—è—Ü.',
            'best_time': '–ú–µ–∂—Å–µ–∑–æ–Ω—å–µ (–∞–ø—Ä–µ–ª—å-–º–∞–π, —Å–µ–Ω—Ç—è–±—Ä—å) - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã.'
        },
        '–∫–∞–∑–∞–Ω—å': {
            'tips': '–ö–∞–∑–∞–Ω—å - –æ—Ç 6 100‚ÇΩ. –ü–æ–ø—É–ª—è—Ä–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –±—Ä–æ–Ω–∏—Ä—É–π—Ç–µ –∑–∞—Ä–∞–Ω–µ–µ.',
            'airlines': 'S7 –∏ –ê—ç—Ä–æ—Ñ–ª–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç —É–¥–æ–±–Ω—ã–µ —Ä–µ–π—Å—ã. –ü—Ä—è–º—ã–µ –¥–µ—à–µ–≤–ª–µ.',
            'best_time': '–ë—É–¥–Ω–∏–µ –¥–Ω–∏ –¥–µ—à–µ–≤–ª–µ –Ω–∞ 30%. –ò–∑–±–µ–≥–∞–π—Ç–µ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤.'
        }
    }
    
    if any(word in message for word in ['—Ü–µ–Ω–∞', '—Å—Ç–æ–∏–º–æ—Å—Ç—å', '—Å–∫–æ–ª—å–∫–æ', '–¥–æ—Ä–æ–≥–æ', '–¥–µ—à–µ–≤–æ']):
        return '–î–ª—è –ª—É—á—à–∏—Ö —Ü–µ–Ω –±—Ä–æ–Ω–∏—Ä—É–π—Ç–µ –∑–∞ 3-4 –Ω–µ–¥–µ–ª–∏. –ë—É–¥–Ω–∏–µ –¥–Ω–∏ –¥–µ—à–µ–≤–ª–µ –Ω–∞ 30-40%. –£—Ç—Ä–µ–Ω–Ω–∏–µ —Ä–µ–π—Å—ã –æ–±—ã—á–Ω–æ –≤—ã–≥–æ–¥–Ω–µ–µ –≤–µ—á–µ—Ä–Ω–∏—Ö. –°—Ä–∞–≤–Ω–∏—Ç–µ —Ü–µ–Ω—ã —É —Ä–∞–∑–Ω—ã—Ö –∞–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏–π!'
    
    if any(word in message for word in ['–∫–æ–≥–¥–∞', '–≤—Ä–µ–º—è', '–ª—É—á—à–µ –ª–µ—Ç–µ—Ç—å', '–¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏']):
        return '–û–ø—Ç–∏–º–∞–ª—å–Ω–æ –ª–µ—Ç–µ—Ç—å –≤—Ç–æ—Ä–Ω–∏–∫-—á–µ—Ç–≤–µ—Ä–≥ - —ç–∫–æ–Ω–æ–º–∏—è –¥–æ 35%. –ò–∑–±–µ–≥–∞–π—Ç–µ –ø—è—Ç–Ω–∏—Ü—ã –∏ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è. –£—Ç—Ä–µ–Ω–Ω–∏–µ —Ä–µ–π—Å—ã (6-9 —É—Ç—Ä–∞) –¥–µ—à–µ–≤–ª–µ –Ω–∞ 20-25%.'
    
    if any(word in message for word in ['–∞–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏—è', '–ø–µ—Ä–µ–≤–æ–∑—á–∏–∫', '–∫—Ç–æ –ª–µ—Ç–∞–µ—Ç', '–∫–∞–∫–∞—è –∫–æ–º–ø–∞–Ω–∏—è']):
        return '–ê—ç—Ä–æ—Ñ–ª–æ—Ç - –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ —á–∞—Å—Ç—ã–µ —Ä–µ–π—Å—ã. S7 - —Ö–æ—Ä–æ—à–∏–π —Å–µ—Ä–≤–∏—Å –∏ —Ü–µ–Ω—ã. Utair - –±—é–¥–∂–µ—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å –∞–∫—Ü–∏—è–º–∏. –Ø–º–∞–ª - –¥–ª—è —Å–µ–≤–µ—Ä–Ω—ã—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π. –°—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ –Ω–∞ Aviasales!'
    
    if any(word in message for word in ['–±–∞–≥–∞–∂', '—á–µ–º–æ–¥–∞–Ω', '–≤–µ—Å', '—Ä—É—á–Ω–∞—è –∫–ª–∞–¥—å']):
        return '–°—Ç–∞–Ω–¥–∞—Ä—Ç: 10–∫–≥ —Ä—É—á–Ω–∞—è –∫–ª–∞–¥—å + 23–∫–≥ –±–∞–≥–∞–∂. –õ–æ—É–∫–æ—Å—Ç–µ—Ä—ã –±–µ—Ä—É—Ç –æ—Ç–¥–µ–ª—å–Ω–æ –∑–∞ –±–∞–≥–∞–∂. –ê—ç—Ä–æ—Ñ–ª–æ—Ç –≤–∫–ª—é—á–∞–µ—Ç 1 –º–µ—Å—Ç–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞ —Å–∞–π—Ç–µ –∞–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏–∏!'
    
    if any(word in message for word in ['–¥–æ–∫—É–º–µ–Ω—Ç—ã', '–ø–∞—Å–ø–æ—Ä—Ç', '–≤–∏–∑–∞', '–Ω—É–∂–Ω–æ –≤–∑—è—Ç—å']):
        return '–í–Ω—É—Ç—Ä–∏ –†–æ—Å—Å–∏–∏: –ø–∞—Å–ø–æ—Ä—Ç –†–§ (–∏–ª–∏ —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –¥–ª—è –¥–µ—Ç–µ–π). –ó–∞–≥—Ä–∞–Ω–∏—Ü—É: –∑–∞–≥—Ä–∞–Ω–ø–∞—Å–ø–æ—Ä—Ç + –≤–∏–∑–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞). –†–∞—Å–ø–µ—á–∞—Ç–∞–π—Ç–µ –±–∏–ª–µ—Ç –∏–ª–∏ –¥–µ—Ä–∂–∏—Ç–µ –≤ —Ç–µ–ª–µ—Ñ–æ–Ω–µ!'
    
    if any(word in message for word in ['—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è', '–æ–Ω–ª–∞–π–Ω', '—á–µ–∫–∏–Ω', '—Å—Ç–æ–π–∫–∞']):
        return '–û–Ω–ª–∞–π–Ω-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∑–∞ 24 —á–∞—Å–∞ –¥–æ –≤—ã–ª–µ—Ç–∞. –≠–∫–æ–Ω–æ–º–∏—Ç 30-40 –º–∏–Ω—É—Ç –≤ –∞—ç—Ä–æ–ø–æ—Ä—Ç—É. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ —Å–∞–π—Ç –∏–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏–∏!'
    
    if any(word in message for word in ['–æ–ø–æ–∑–¥–∞–ª', '–∑–∞–¥–µ—Ä–∂–∫–∞', '—Ä–µ–π—Å –æ—Ç–º–µ–Ω–∏–ª–∏', '–Ω–µ —É—Å–ø–µ–ª']):
        return '–ü—Ä–∏ –∑–∞–¥–µ—Ä–∂–∫–µ –æ—Ç 2 —á–∞—Å–æ–≤ - –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è. –ï—Å–ª–∏ –æ–ø–æ–∑–¥–∞–ª–∏ - –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫—É –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞. –î–µ—Ä–∂–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –∞–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ–¥ —Ä—É–∫–æ–π!'
    
    for city, info in cities_info.items():
        if city in message:
            if '—Ü–µ–Ω–∞' in message or '—Å—Ç–æ–∏–º–æ—Å—Ç—å' in message:
                return info['tips']
            elif '–∞–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏—è' in message or '–ø–µ—Ä–µ–≤–æ–∑—á–∏–∫' in message:
                return info['airlines']
            elif '–∫–æ–≥–¥–∞' in message or '–≤—Ä–µ–º—è' in message:
                return info['best_time']
            else:
                return info['tips']
    
    premium_general = [
        '–û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è! –†–µ–∫–æ–º–µ–Ω–¥—É—é –±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞ 3-4 –Ω–µ–¥–µ–ª–∏ - —ç–∫–æ–Ω–æ–º–∏—è –¥–æ 40%. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–∫—Ü–∏–∏ –Ω–∞ —Å–∞–π—Ç–∞—Ö –∞–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏–π.',
        '–î–ª—è –ø–æ–∏—Å–∫–∞ –ª—É—á—à–∏—Ö —Ü–µ–Ω –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Aviasales –∏–ª–∏ Skyscanner. –ë—É–¥–Ω–∏–µ –¥–Ω–∏ –¥–µ—à–µ–≤–ª–µ –≤—ã—Ö–æ–¥–Ω—ã—Ö –Ω–∞ 30%. –ì–∏–±–∫–∏–µ –¥–∞—Ç—ã –ø–æ–º–æ–≥—É—Ç —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å!',
        '–°–æ–≤–µ—Ç: –ø–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫–∏ –∞–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏–π - —Ç–∞–º –±—ã–≤–∞—é—Ç —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Å–∫–∏–¥–∫–∏ –¥–æ 50%. –†–∞–Ω–Ω–µ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ = –Ω–∏–∑–∫–∏–µ —Ü–µ–Ω—ã!',
        '–ü—Ä—è–º—ã–µ —Ä–µ–π—Å—ã –¥–æ—Ä–æ–∂–µ, –Ω–æ —ç–∫–æ–Ω–æ–º—è—Ç 3-5 —á–∞—Å–æ–≤. –ü–µ—Ä–µ—Å–∞–¥–∫–∏ –¥–µ—à–µ–≤–ª–µ –Ω–∞ 20-40%. –û—Ü–µ–Ω–∏—Ç–µ —Å–≤–æ–µ –≤—Ä–µ–º—è vs —ç–∫–æ–Ω–æ–º–∏—é!',
        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏–π: –ê—ç—Ä–æ—Ñ–ª–æ—Ç (–ø—Ä–µ–º–∏—É–º), S7 (–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ), Utair (–±—é–¥–∂–µ—Ç). –£ –∫–∞–∂–¥–æ–π —Å–≤–æ–∏ –∞–∫—Ü–∏–∏ –∏ —É—Å–ª–æ–≤–∏—è!'
    ]
    
    return random.choice(premium_general)
